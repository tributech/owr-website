---
/**
 * Stats bar showing platform numbers.
 * Fetched client-side from the Rails API â€” falls back to placeholder dashes.
 */
const stats = [
  { label: 'Active Players', icon: 'users' },
  { label: 'Tournaments', icon: 'trophy' },
  { label: 'Army Lists', icon: 'swords' },
  { label: 'Regions', icon: 'map-pin' },
];
---

<section id="stats" class="bg-white border-y border-gray-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8" id="stats-bar">
      {stats.map((stat) => (
        <div class="text-center">
          <div class="flex items-center justify-center mb-2">
            <span class="text-2xl sm:text-3xl font-bold text-gray-900" data-stat={stat.icon}>
              &mdash;
            </span>
          </div>
          <p class="text-sm text-gray-500">{stat.label}</p>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  import { apiFetch, type LandingStats } from '../lib/api';

  async function loadStats() {
    const data = await apiFetch<LandingStats>('/api/v1/landing/stats');
    if (!data) return;

    const mapping: Record<string, number> = {
      users: data.player_count,
      trophy: data.tournament_count,
      swords: data.army_list_count,
      'map-pin': data.region_count,
    };

    Object.entries(mapping).forEach(([key, value]) => {
      const el = document.querySelector(`[data-stat="${key}"]`);
      if (el && value) el.textContent = Number(value).toLocaleString();
    });
  }

  loadStats();
</script>
